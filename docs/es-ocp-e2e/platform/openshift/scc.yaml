# Security Context Constraints for Elasticsearch on OpenShift
# ECK requires privileged SCCs for the init containers
apiVersion: security.openshift.io/v1
kind: SecurityContextConstraints
metadata:
  name: es-ocp-e2e-elasticsearch
  labels:
    app.kubernetes.io/name: es-ocp-e2e
allowPrivilegedContainer: true
allowPrivilegeEscalation: true
allowHostDirVolumePlugin: false
allowHostIPC: false
allowHostNetwork: false
allowHostPID: false
allowHostPorts: false
readOnlyRootFilesystem: false
requiredDropCapabilities:
  - KILL
  - MKNOD
  - SETUID
  - SETGID
runAsUser:
  type: RunAsAny
seLinuxContext:
  type: MustRunAs
fsGroup:
  type: RunAsAny
supplementalGroups:
  type: RunAsAny
volumes:
  - configMap
  - downwardAPI
  - emptyDir
  - persistentVolumeClaim
  - projected
  - secret
users:
  - system:serviceaccount:es-ocp-e2e:default
  - system:serviceaccount:es-ocp-e2e:elastic-agent
---
# Grant SCC to service accounts
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: es-ocp-e2e-scc
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:openshift:scc:es-ocp-e2e-elasticsearch
subjects:
  - kind: ServiceAccount
    name: default
    namespace: es-ocp-e2e
